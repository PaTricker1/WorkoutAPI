<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Log</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }

        input, select {
            width: 95%;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        /* Responsive design for small screens */
        @media (max-width: 768px) {
            th, td {
                font-size: 12px;
                padding: 5px;
            }

            input, select {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>

    <h2 style="text-align: center;">Workout Log</h2>

    <div class="button-container">
        <label for="rowCount">Enter number of rows: </label>
        <input type="number" id="rowCount" value="4" min="1" />
        <button onclick="generateTable()">Generate Table</button>
        <button onclick="sendDataToDatabase()">Send to Database</button>
    </div>

    <div style="overflow-x: auto;">
        <table id="workoutTable"></table>
    </div> 

    <script>
        // List of predefined exercises
        const predefinedExercises = [
            "Bench",
            "Bench dumbells",
            "Seated push",
            "Chest fly",
            "Triceps pushdown",
            "Seated dip",
            "Lateral raise",
            "Shoulder press",
            "Pullup",
            "Pulldown",
            "Lat row",
            "Bent over row",
            "Cable curl",
            "Front raise",
            "Rear delt raise",
            "Squat",
            "Quad extension",
            "Ham curl",
            "Calf raise",
            "Hip abduction",
            "Hip adduction",
            "Deadlift",
            "Dip"
        ];

        let previousData = []; // Store previous table data

        // Function to generate the table dynamically
        function generateTable() {
            const rowCount = parseInt(document.getElementById('rowCount').value);
            const table = document.getElementById('workoutTable');
            table.innerHTML = '';  // Clear existing table content

            // Table header
            const header = document.createElement('tr');
            const headers = [
                'Date', 'Exercise Name', 'Rep1', 'Weight1', 'Rep2', 'Weight2',
                'Rep3', 'Weight3', 'Rep4', 'Weight4'
            ];
            for (let headerText of headers) {
                const th = document.createElement('th');
                th.innerText = headerText;
                header.appendChild(th);
            }
            table.appendChild(header);

            // Get the data for the required number of rows
            const data = previousData.slice(0, rowCount); // Use the first 'rowCount' entries or leave them empty

            // Table rows
            for (let i = 0; i < rowCount; i++) {
                const row = document.createElement('tr');

                // Add a date cell with current date for each row
                const dateCell = document.createElement('td');
                const dateInput = document.createElement('input');
                dateInput.type = 'date';
                dateInput.value = data[i] ? data[i][0] : new Date().toISOString().split('T')[0]; // Use saved date or the current date
                dateInput.addEventListener('input', function() { saveData(); });
                dateCell.appendChild(dateInput);
                row.appendChild(dateCell);

                // Add dropdown for predefined exercises
                const exerciseCell = document.createElement('td');
                const exerciseSelect = document.createElement('select');
                predefinedExercises.forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise;
                    option.textContent = exercise;
                    exerciseSelect.appendChild(option);
                });
                exerciseSelect.value = data[i] ? data[i][1] : predefinedExercises[0];
                exerciseSelect.addEventListener('change', function() { saveData(); });
                exerciseCell.appendChild(exerciseSelect);
                row.appendChild(exerciseCell);

                // Add input fields for the remaining columns
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = data[i] ? data[i][j + 2] : '';
                    input.placeholder = headers[j + 2];
                    input.addEventListener('input', function() { saveData(); });
                    cell.appendChild(input);
                    row.appendChild(cell);
                }

                table.appendChild(row);
            }
        }

        // Function to save data instantly when anything changes in the table
        function saveData() {
            const table = document.getElementById('workoutTable');
            const rows = table.querySelectorAll('tr');
            previousData = [];

            rows.forEach((row, rowIndex) => {
                if (rowIndex === 0) return; // Skip header row
                const cells = row.querySelectorAll('td input, td select');
                const rowData = [];
                cells.forEach(cell => {
                    const value = cell.value.trim();
                    rowData.push(value === "" ? "0" : value); // Replace empty string with "0"
                });
                previousData.push(rowData);
            });
        }

        function sendDataToDatabase() {
            const data = previousData;
            console.log('Sending data to the backend:', data);

            fetch('https://workoutapi-ul58.onrender.com/api/workouts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(data => {
                alert('Data successfully sent to the database!');
            })
            .catch(error => {
                console.error('Error sending data:', error);
            });
        }

        // Initialize the table with the default row count
        generateTable();
    </script>

</body>
</html>
